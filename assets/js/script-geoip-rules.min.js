jQuery(document).ready(function(f){e();function e(){f("#_add_rule_row").click(a);if(0<f(".select_type").length){f("#yith_wcgeoip_rules_panel").on("keyup",".finder",function(){var g=f(this).closest("td").prev(".option_select").find(".select_type");$selected_type=g.val(),$type=g.find("option:selected").data("type");if($selected_type!="custom_url"&$selected_type!="custom_url_regex"){f(this).autocomplete({minLength:3,source:function(i,h){i.select=$selected_type;i.type=$type;c(i,h)},select:function(h,i){f(this).val(i.item.permalink);return false}}).autocomplete("instance")._renderItem=function(i,j){var m=f("<li>");var h=f("<div>");var l=f("<b>").append(j.title);var k=f("<i>").append(f("<small>").append(" ("+j.permalink+")"));l.appendTo(h);k.appendTo(h);h.appendTo(m);return m.appendTo(i)}}})}f("#yith_wcgeoip_rules_panel").on("change",".select_type",function(){var g=f(this).closest(".yith_wcgeoip_rule_row");var j=f(this).find("option:selected");var k=f(this).closest(".form-field").next(".form-field");if(j.hasClass("all")|j.hasClass("archive")){k.find(".finder").prop("readonly",true);k.find(".finder").val(j.data("placeholder"))}else{k.find(".finder").prop("readonly",false);k.find(".finder").val("")}if(f(this).hasClass("origin")){var l=g.find(".option_select>.destination");var i=g.find(".option-destinantion>.finder").first();var h=j.data("type");if("_custom_type"==h|j.hasClass("all")|j.hasClass("archive")){l.val("custom_url");i.val(j.data("placeholder"))}else{l.val(f(this).val());l.trigger("change")}}});f("#yith_wcgeoip_rules_panel").on("change","._rule",function(){var h=f("#_data_to_save"),g=f(this).closest(".yith_wcgeoip_rule_row").attr("id");if(h.val().split(",").indexOf(g)<0){if(0==h.val().length){h.val(g)}else{h.val(h.val()+","+g)}}f("#_data_to_save").val(f("#_data_to_save").val().replace(",,",","))});f(".origin").each(function(){var g=f(this).find("option:selected");var h=f(this).closest(".form-field");if(g.hasClass("all")|g.hasClass("archive")){h.find(".finder").prop("readonly",true)}});f("#_save_rules").click(function(j){var l=false;f(".finder").each(function(m){l=(f(this).val().length==0)?true:l});if(!l){j.preventDefault();var h=f("#_data_to_save").val().split(","),g=f("#_data_to_remove").val().split(","),i=f("._rule").serialize();var k="action=save_rules_action&_rules_to_save="+h+"&_rules_to_remove="+g+"&"+i;f("#yith_wcgeoip_rules_panel").block({message:null,overlayCSS:{background:"#fff",opacity:0.6}});f.post(ajaxurl,k).success(function(n){f("#_data_to_save").val("");f("#_data_to_remove").val("");for(var m=0;m<n.length;m++){f("#_rules_"+n[m].index+"_rule_ID").val(n[m].id_rule)}f("#yith_wcgeoip_rules_panel").unblock()})}});f("#yith_wcgeoip_rules_panel").on("click",".remove_rule",function(l){l.preventDefault();var i=f("#_data_to_remove"),h=f(this).closest(".yith_wcgeoip_rule_row"),k=h.attr("id"),g=f("#_rules_"+k+"_rule_ID").val();if("new"!=g){if(i.val().split(",").indexOf(g)<0){if(0==i.val().length){i.val(g)}else{i.val(i.val()+","+g)}}i.val(i.val().replace(",,",","))}var j=new RegExp(k+",?");f("#_data_to_save").val(f("#_data_to_save").val().replace(j,""));h.remove();d()});f(".yith_geoip_table_rules").sortable({stop:function(g,h){d()}})}function a(g){g.preventDefault();f("#yith_wcgeoip_rules_panel").block({message:null,overlayCSS:{background:"#fff",opacity:0.6}});var h={action:"print_rule_row_action",index:f(".yith_wcgeoip_rule_row").length};f.post(ajaxurl,h).success(function(i){f("#yith_wcgeoip_rules_panel").find("table").find("tbody").append(i);f(".wc-enhanced-select").trigger("wc-enhanced-select-init");f("#yith_wcgeoip_rules_panel").unblock()})}function c(h,g){var i={dataType:"json",action:"finder_source_action",data:{term:h.term,type:h.type,select:h.select}};f.post(ajaxurl,i).success(function(n){var j=new Array();for(var k=0;k<n.length;k++){var m=b(n[k].permalink);var l={id:n[k].id,title:n[k].title,permalink:m};j.push(l)}g(j)})}function d(){f("._rule_order").each(function(g){f(this).val(g);f(this).trigger("change")})}function b(i){if(i){var g=i.indexOf("?");if(0<=g){var h=("/"==i.substring(g-1,g))?true:false;if(!h){var j=i.slice(0,g)+"/"+i.slice(g);i=j}}}return i}});